<!DOCTYPE html>
<html lang="en" dir="ltr" style="--color--primary-hue:202;--color--primary-saturation:79%;--color--primary-lightness:50">
  <head>
    <meta charset="utf-8" />
<meta name="Generator" content="Drupal 10 (https://www.drupal.org)" />
<meta name="MobileOptimized" content="width" />
<meta name="HandheldFriendly" content="true" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" href="/themes/custom/joachim_blog_theme/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="alternate" type="application/rss+xml" title="Blog" href="https://joachim-n.github.io/blog.xml" />

    <title>Blog | Joachim&#039;s blog</title>
    <link rel="stylesheet" media="all" href="/sites/default/files/css/css_ihN9gV-WXsqs_8HEEt45YyjirGu6jPu5ot_R6_FnoJc.css?delta=0&amp;language=en&amp;theme=joachim_blog_theme&amp;include=eJxtiksOgCAQxS4EciTD54no4Bhn1HB7jQtXbJqmaeSEqZDicPFXs7CPc6ljIM6jzqhwE5B6PRMHT1a0Udly79j5xoFkQ7NvjWvvUZ_FSBNFdcELzFVwi_s4VE4n4QEvZUJF" />
<link rel="stylesheet" media="all" href="/sites/default/files/css/css_1jXAH4oZpERf974X1bp6_kLxFzUh9NogUun0JLEBbNE.css?delta=1&amp;language=en&amp;theme=joachim_blog_theme&amp;include=eJxtiksOgCAQxS4EciTD54no4Bhn1HB7jQtXbJqmaeSEqZDicPFXs7CPc6ljIM6jzqhwE5B6PRMHT1a0Udly79j5xoFkQ7NvjWvvUZ_FSBNFdcELzFVwi_s4VE4n4QEvZUJF" />

    
    
<link rel="preload" href="/themes/custom/joachim_blog_theme/fonts/metropolis/Metropolis-Regular.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/themes/custom/joachim_blog_theme/fonts/metropolis/Metropolis-SemiBold.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/themes/custom/joachim_blog_theme/fonts/metropolis/Metropolis-Bold.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/themes/custom/joachim_blog_theme/fonts/lora/lora-v14-latin-regular.woff2" as="font" type="font/woff2" crossorigin>
    <noscript><link rel="stylesheet" href="/themes/custom/joachim_blog_theme/css/components/navigation/nav-primary-no-js.css?sspisc" />
</noscript>
  </head>
  <body class="path-frontpage">
        <a href="#main-content" class="visually-hidden focusable skip-link">
      Skip to main content
    </a>
    
      <div class="dialog-off-canvas-main-canvas" data-off-canvas-main-canvas>
    
<div id="page-wrapper" class="page-wrapper">
  <div id="page">

          <header id="header" class="site-header" data-drupal-selector="site-header" role="banner">

                <div class="site-header__fixable" data-drupal-selector="site-header-fixable">
          <div class="site-header__initial">
            <button class="sticky-header-toggle" data-drupal-selector="sticky-header-toggle" role="switch" aria-controls="site-header__inner" aria-label="Sticky header" aria-checked="false">
              <span class="sticky-header-toggle__icon">
                <span></span>
                <span></span>
                <span></span>
              </span>
            </button>
          </div>

                    <div id="site-header__inner" class="site-header__inner" data-drupal-selector="site-header-inner">
            <div class="container site-header__inner__container">

              


<div id="block-joachim-blog-theme-site-branding" class="site-branding block block-system block-system-branding-block">
  
    
    <div class="site-branding__inner">
              <div class="site-branding__text">
        <div class="site-branding__name">
          <a href="/" title="Home" rel="home">Joachim&#039;s blog</a>
        </div>
      </div>
      </div>
</div>
<nav  id="block-joachim-blog-theme-main-menu" class="primary-nav block block-menu navigation menu--main" aria-labelledby="block-joachim-blog-theme-main-menu-menu" role="navigation">
            
  <h2 class="visually-hidden block__title" id="block-joachim-blog-theme-main-menu-menu">Main navigation</h2>
  
        
          <ul  class="menu menu--level-1">
            
                          
        
        
        <li class="menu__item menu__item--link menu__item--level-1">
                    
          <a href="/" class="menu__link menu__link--link menu__link--level-1" data-drupal-link-system-path="&lt;front&gt;">Home</a>

          
        </li>
      
                          
        
        
        <li class="menu__item menu__item--link menu__item--level-1">
                    
          <a href="/about" class="menu__link menu__link--link menu__link--level-1" data-drupal-link-system-path="node/1">About</a>

          
        </li>
          </ul>
  


  </nav>

<div class="header-nav-overlay" data-drupal-selector="header-nav-overlay"></div>


                          </div>
          </div>
        </div>
      </header>
    
    <div id="main-wrapper" class="layout-main-wrapper layout-container">
      <div id="main" class="layout-main">
        <div class="main-content">
          <a id="main-content" tabindex="-1"></a>
          
          <div class="main-content__container container">
            

  <div class="region region--highlighted grid-full layout--pass--content-medium">
    <div data-drupal-messages-fallback class="hidden messages-list"></div>

  </div>

            



                          <main role="main">
                

  <div class="region region--content-above grid-full layout--pass--content-medium">
    

<div id="block-joachim-blog-theme-page-title" class="block block-core block-page-title-block">
  
  

  <h1 class="title page-title">Blog</h1>


  
</div>

  </div>

                

  <div class="region region--content grid-full layout--pass--content-medium" id="content">
    

<div id="block-joachim-blog-theme-content" class="block block-system block-system-main-block">
  
    
      <div class="block__content">
      <div class="views-element-container"><div class="view view-blog view-id-blog view-display-id-page_1 js-view-dom-id-ed82cd1562eb910be519741d72f1f9a7104ffe0225a272489bd3850cc588cbda">
  
    
      
      <div class="view-content">
          <div class="views-row">

<article class="node node--type-article grid-full node--view-mode-full">
  <header class="layout--content-narrow">
    
            <h2 class="node__title">
        <a href="/blog/concept-limiting-taxonomy-terms-common-fields" rel="bookmark">
<span>A concept for limiting taxonomy terms by common fields</span>
</a>
      </h2>
        
          <div class="node__meta">
              <div class="node__author-image">
          <div>
  </div>

        </div>
              <span>
          By <span><span>joachim</span></span>, Wed, 11/23/2011 - 13:20
        </span>
        
      </div>
      </header>
  <div class="node__content layout--content-narrow">
        
            <div class="text-content clearfix field field--name-body field--type-text-with-summary field--label-hidden field__item"><p>There are several modules that provide taxonomy term widgets that are more efficient at drilling down into large and complex vocabularies of terms, but I've not yet found something that just limits terms in some way.</p>
<p>The use case is somewhat like this: I have products that are classified by sport and by team. And teams can be rugby teams or football teams, and so on. Having one vocabulary per type of team feels somewhat weak, but putting them all in one vocabulary means the user has to wade through a lot of irrelevant terms.</p>
<p>So I've been thinking of ways to limit the terms in the field widget. I don't think this is something I'm going to develop (for reasons that will become clear), but it's just a wacky idea[*] I'm putting out there.</p>
<p>I've discarded my initial thought to use a hierarchy of terms, because that would result in terms that are essentially empty: the group of football team terms is not correctly a team term. It would also mean needing to prevent its selection in the widget, and its appearance in filter forms.</p>
<p>What I've landed on as a concept instead seems wacky but I think makes a lot of sense: now we can have fields on anything, we can <em>match them</em>. What I mean by this is that we compare the value in the 'sport' field on the product, and the value in the <em>identical sport field</em> applied to the terms. (Yes, taxonomy terms on taxonomy terms. It was bound to happen eventually, right?)</p>
<p>In terms of IA, this is actually quite simple and logical: add a term reference field to the team vocabulary, and add the sport field, which is already on products, to the team terms (which the client will be doing; I have no idea what teams belong to what sport).</p>
<p>In terms of the work the UI has to do, it's not that complex either once it's laid out. It goes like this: when the value in the sport field changes, make an ajax call on the team field. In the callback, load all the terms. For each term, look at its team value. Does that match the current value of the sport field in the product form? If so, let the term into the new options array. If not, discard it.</p>
<p>It's simple, but I've hit a problem: we have two really good JavaScript systems in Drupal 7 that work very well individually, but as far as I can tell live in completely different universes. The states system is great for telling one form element to show, hide, or change its value depending on the value of another element. The ajax system is great for telling one form element to react to a change in itself by updating something via ajax. What I don't see how to do is get the term reference widget element to watch for changes in other elements (like the states system does), and then update itself with ajax (using the ajax system ideally).</p>
<p>So that's where I've hit the buffers: my JavaScript skills are pretty minimal, and so that's where I leave this latest wacky idea for now. I've got proof-of-concept code of a term reference widget updating itself via ajax based on form values, but the missing piece is getting it to react to changes in another field, whose form elements can't be altered in PHP (because the term reference widget is being changed in hook_field_widget_form_alter(), which only sees that form element). I'd be grateful for any hints; I actually think this model is not as wacky as it first seems and could have a lot of applications.</p>
<p>[*] Back at DrupalCon London I chanced upon a conversation webchick and stella were having about Coder review automation on Drupal.org, and prefixed a suggestion with, 'I've got a wacky idea...', to which webchick said, 'When are your ideas not wacky?' I don't know whether it was just an off the cuff quip, or whether I really do come up with a lot of crazy stuff. I guess I can live with that reputation ;)</p>
</div>
      

<div class="field field--name-field-tags field--type-entity-reference field--label-above field--tags">
      <h3 class="field__label field--tags__label">Tags</h3>
    <ul class="links field__items field--tags__items">
          <li class="field--tags__item"><a href="/taxonomy/term/1" hreflang="en">drupal</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/6" hreflang="en">drupal planet</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/43" hreflang="en">taxonomy</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/44" hreflang="en">javascript</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/45" hreflang="en">ajax</a></li>
      </ul>
</div>

  </div>
  </article>
</div>
    <div class="views-row">

<article class="node node--type-article grid-full node--view-mode-full">
  <header class="layout--content-narrow">
    
            <h2 class="node__title">
        <a href="/blog/dynamically-changing-views-table-joins" rel="bookmark">
<span>Dynamically changing Views table joins</span>
</a>
      </h2>
        
          <div class="node__meta">
              <div class="node__author-image">
          <div>
  </div>

        </div>
              <span>
          By <span><span>joachim</span></span>, Fri, 10/28/2011 - 08:52
        </span>
        
      </div>
      </header>
  <div class="node__content layout--content-narrow">
        
            <div class="text-content clearfix field field--name-body field--type-text-with-summary field--label-hidden field__item"><p>I've recently had cause to make Views make joins to tables in peculiar ways. Here's some notes on the peculiar things I did with the views_join class to accomplish that.</p>
<p>First of all I'll briefly recap how we define a table to Views. Each item in the $data array returned to hook_view_data() represents all the information about a table. Each key in the array is a field on that table (well, or pseudofield), except for the 'table' key which has the basic data about our table, like this:</p>
<div class="codeblock"><code>$data['my_table'] = array(<br>&nbsp; // This defines how the table joins back to different bases.<br>&nbsp; 'table' =&gt; array(<br>&nbsp;&nbsp;&nbsp; // How to join back to the base table 'crm_party'.<br>&nbsp;&nbsp;&nbsp; 'crm_party' =&gt; array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'left_field' =&gt; 'pid',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'field' =&gt; 'pid',<br>&nbsp;&nbsp;&nbsp; ),<br>&nbsp; ),<br>);<br>// Now we can add field definitions on this table.</code></div>
<p>That's the simplest case. It says, 'to join back to {crm_party}, join on the column 'pid' on both tables'. (Note I will say 'column' when I am speaking of the database, and 'field' for Views, though that can mean both a field that you add to the view, and a field on the table that provides filters, sorts, or arguments.)</p>
<p>So adding a field on this table will cause Views to add this join clause to the query:</p>
<p> ... JOIN my_table ON crm_party.pid = my_table.pid</p>
<p>We can easily join where the columns have different names, by giving different values for 'field' and 'left_field' in the table definition.</p>
<p>If the join requires conditions, that's where the 'extra' clause comes in, like this:</p>
<div class="codeblock"><code>// How to join back to the base table 'crm_party'.<br>'crm_party' =&gt; array(<br>&nbsp; 'left_field' =&gt; 'pid',<br>&nbsp; 'field' =&gt; 'pid',<br>&nbsp; 'extra' =&gt; 'foo = 42',<br>),</code></div>
<p>This now gives us:</p>
<p>... JOIN my_table ON crm_party.pid = my_table.pid AND foo = 42</p>
<p>The 'extra' can also take an array, in which case each item is an array containing field, operator, and value. (If it seems a bit like the <a href="http://drupal.org/developing/api/database">Database API</a>, but not quite, that's because all this was introduced in Views 2 on Drupal 6).</p>
<div class="codeblock"><code>// How to join back to the base table 'crm_party'.<br>'crm_party' =&gt; array(<br>&nbsp; 'left_field' =&gt; 'pid',<br>&nbsp; 'field' =&gt; 'pid',<br>&nbsp; 'extra' =&gt; array(<br>&nbsp;&nbsp;&nbsp; // The 'extra' array is numeric, hence has no keys. This always looks odd to me!<br>&nbsp;&nbsp;&nbsp; array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'field' =&gt; 'foo',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'value' =&gt; 42,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'numeric' =&gt; TRUE,<br>&nbsp;&nbsp;&nbsp; ),<br>&nbsp; ),<br>),</code></div>
<p>So far, this is all covered in the Advanced Help documentation contained within Views. But for our relationship handler from <a href="http://drupal.org/sandbox/joachim/1260650">CRM Parties</a> to attached entities, we needed a condition on the join depending on values selected in the UI. So the 'extra', defined in hook_views_alter(), won't do, as it's not changeable. Or is it?</p>
<p>When a relationship handler is adding itself to the query, the query hasn't been fully built yet. Rather, Views has a views_plugin_query_default object which will eventually be used to make a DatabaseAPI SelectQuery. This means we can actually reach into the table queue and change the definition for any table to the left of us, like this:</p>
<div class="codeblock"><code>// Our relationship handler's query method:<br>function query() {<br>&nbsp; // Call our parent query method to set up all our tables and joins.<br>&nbsp; parent::query();<br><br>&nbsp; if ($this-&gt;options['main']) {<br>&nbsp;&nbsp;&nbsp; // This is a little weird.<br>&nbsp;&nbsp;&nbsp; // We don't add an 'extra' (ie a further join condition) on our<br>&nbsp;&nbsp;&nbsp; // relationship join, but rather on the join that got us here from<br>&nbsp;&nbsp;&nbsp; // the {crm_party} table.<br>&nbsp;&nbsp;&nbsp; // This means reaching into the query object's table queue and fiddling<br>&nbsp;&nbsp;&nbsp; // with the join object.<br>&nbsp;&nbsp;&nbsp; // Setting a join handler for the join definition is not useful, as that<br>&nbsp;&nbsp;&nbsp; // would have no knowledge of the user option set in this relationship<br>&nbsp;&nbsp;&nbsp; // handler.<br>&nbsp;&nbsp;&nbsp; // @todo: It might however be cleaner to set one anyway and give it<br>&nbsp;&nbsp;&nbsp; // a method to add the extra rather than hack the object directly...<br>&nbsp;&nbsp;&nbsp; $table = $this-&gt;table;<br>&nbsp;&nbsp;&nbsp; $base_join = $this-&gt;query-&gt;table_queue[$table]['join'];<br>&nbsp;&nbsp;&nbsp; $base_join-&gt;extra = array(array('field' =&gt; 'main', 'value' =&gt; TRUE));<br>&nbsp; }</code></div>
<p>When I wrote those comments in the code last week, I'd found that using a custom join handler isn't useful, because that has no knowledge of the relationship handler's data. However, this week I found myself working on a different case where I did need to find a way to do just that.</p>
<p>This week's problem was <a href="http://drupal.org/node/1318358">how to filter out Drupal Commerce products that are in the current cart</a>, or more generally in any order (and the current cart's order ID can be supplied with a default argument plugin).</p>
<p>It seems a reasonable enough thing to ask of Views, but it's actually pretty complex, as what's in a cart or order is not products but line items, each of which refers to a product with a reference field.</p>
<p>After several failed attempts, I managed to write a query that produces the correct result, but it requires joining to a subquery which itself has the order ID within it (see the issue for gory details).</p>
<p>The first hurdle with this is easy to overcome: there's nothing wrong about telling Views about a table that doesn't exist. This is often done with aliased tables, but in fact it can be totally fictional provided we also provide our own join handler which understands what to do to the query. That can be anything, as long as the SELECT fields we also add make sense. Hence it's fine to do this in hook_views_data():</p>
<div class="codeblock"><code>// Fake table for the 'product is in order' argument, made from a subquery.<br>$data['commerce_product_commerce_line_item'] = array(<br>&nbsp; 'table' =&gt; array(<br>&nbsp;&nbsp;&nbsp; 'group' =&gt; 'Commerce Product',<br>&nbsp;&nbsp;&nbsp; 'join' =&gt; array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Join to the commerce_product base.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'commerce_product' =&gt; array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'left_field' =&gt; 'entity_id',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'field' =&gt; 'line_item_id',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'handler' =&gt; 'views_join_commerce_product_line_item',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>&nbsp;&nbsp;&nbsp; ),<br>&nbsp; ),<br>);</code></div>
<p>Our custom join class now has to add the subquery to the view, but it also needs the argument value to do this.</p>
<p>The way I worked around this was to override the ensure_my_table() method in the argument handler. Normally, this calls $this-&gt;query-&gt;ensure_table() which then creates the join, but ensure_table() can take a join parameter to work with. The overridden version of ensure_my_table() creates the join object, and sets the argument value on it:</p>
<div class="codeblock"><code>function ensure_my_table() {<br>&nbsp; // Pre-empt views_plugin_query_default::ensure_table() by setting our join up now.<br>&nbsp; // Argh, hack this in for now. This may mean relationships using this break?<br>&nbsp; $relationship = 'commerce_product';<br><br>&nbsp; // Get a join object for our table.<br>&nbsp; // This is of class views_join_commerce_product_line_item, which takes<br>&nbsp; // care of joining to a subquery rather than a table.<br>&nbsp; $join = $this-&gt;query-&gt;get_join_data($this-&gt;table, $this-&gt;query-&gt;relationships[$relationship]['base']);<br><br>&nbsp; // We add the argument value to the join handler as it needs to use it<br>&nbsp; // within its subquery.<br>&nbsp; $join-&gt;argument = $this-&gt;argument;</code></div>
<p>This means that in the build_join() method for our custom join handler, views_join_commerce_product_line_item, we can rely on the argument value that the views has received:</p>
<div class="codeblock"><code>function build_join($select_query, $table, $view_query) {<br>&nbsp; // (snip...) build a SelectQuery object for the subquery<br>&nbsp; // Set the condition based on the argument value.<br>&nbsp; $subquery-&gt;condition('cli.order_id', $this-&gt;argument);<br>&nbsp; // (snip...)<br>&nbsp; // Add the join on the subquery.<br>&nbsp; $select_query-&gt;addJoin($this-&gt;type, $subquery, $table['alias'], $condition);</code></div>
<p>The views_join class's build_join() method is where the Views system of building a query is translated into a DatabaseAPI SelectQuery object. Here we build up our own query (and we don't need Views-safe aliases, as it's a completely internal, non-correlated subquery), and pass it in as a join which uses it as a subquery.</p>
<p>It remains only for the argument handler's query() method to add the conditions for its field, using the alias and field names we gave for the subquery.</p>
<p>In conclusion, the data structure Views understands may appear to be a fixed, declared thing, but with a little bit of tweaking the way tables are joined in a Views query can be affected by both site configuration and user input.</p>
</div>
      

<div class="field field--name-field-tags field--type-entity-reference field--label-above field--tags">
      <h3 class="field__label field--tags__label">Tags</h3>
    <ul class="links field__items field--tags__items">
          <li class="field--tags__item"><a href="/taxonomy/term/1" hreflang="en">drupal</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/40" hreflang="en">views</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/41" hreflang="en">drupal commerce</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/42" hreflang="en">drupal crm</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/6" hreflang="en">drupal planet</a></li>
      </ul>
</div>

  </div>
  </article>
</div>
    <div class="views-row">

<article class="node node--type-article grid-full node--view-mode-full">
  <header class="layout--content-narrow">
    
            <h2 class="node__title">
        <a href="/blog/its-amazing-what-you-find-crusty-bits-menu-system/505" rel="bookmark">
<span>It&#039;s Amazing What You Find: Crusty Bits of the Menu System</span>
</a>
      </h2>
        
          <div class="node__meta">
              <div class="node__author-image">
          <div>
  </div>

        </div>
              <span>
          By <span><span>joachim</span></span>, Sun, 10/17/2010 - 16:13
        </span>
        
      </div>
      </header>
  <div class="node__content layout--content-narrow">
        
            <div class="text-content clearfix field field--name-body field--type-text-with-summary field--label-hidden field__item"><p>I've been poking in the innards of the menu system the last few days. This is due to yet another client wanting to do something that goes completely against the grain of Drupal.</p>
<p>In this case, it's the way Drupal only shows you menu links you have access to. This to me seems perfectly reasonable good usability: why show you something you can't use? On the other hand, there is a long-standing feature in Comment module that shows anonymous users a 'Login or register to post comments' link on nodes, so 'incitements to action' or <a href="http://whatthefuckismysocialmediastrategy.com/">whatever the social media buzzword is</a> do exist in Drupal.</p>
<p>So the challenge was to show a link that the anonymous user can't use, send them to login, and back to the link they wanted in the first place. The last part is just some hook_form_alter() work with form redirection (though it did allow me to discover that everything drupal_get_form() is passed <em>is</em> available to the alter hooks, just <a href="http://drupal.org/node/942718">in a funny place</a>). The access to the menu item is done by intercepting in hook_menu_item_alter() to save a twin of the menu item, and a checkbox in the menu edit form to trigger this. Even registering the path is easy: a custom menu access callback which takes as access arguments those of the original item <em>plus its access callback</em> and negates whatever the original item would return for access. The part I'm (so far) stuck on is getting hook_menu_alter() to know about what the admin user has done in hook_menu_item_alter(): the next job will probably involve creating a truly ugly query that uses %LIKE% to grab menu items based on their options array.</p>
<p>But that's not what I came here to tell you about today.</p>
<p>In my prodding around of the menu system, I found that menu router items have a 'block_callback' property, with its own database field and everything. Now get this: only <em>one</em> item in the entire {menu_router} table on D6 has this filled, and to boot, it has <em>absolutely no effect</em>. (It's the admin theme page, by the way.) This property is something to do with the way that the root admin page is made out of things that are sort of blocks, but not quite. If the property exists on the router item, then the callback is called to add (!!) to the content. (The admin theme page of course plays no part in the root admin page.)</p>
<p>So we had here a completely useless database field, probably left over from Drupal 5 or even earlier. By the way, in a standard Drupal 7 install, the database field is <em>completely</em> unused. I made a dummy patch to get the issue queue testbot confirm that <a href="http://drupal.org/node/943558">we never get to this particular piece of code</a>, and the superfluous field has now been removed. It's amazing what you find!</p>
<p>By the way, if anyone fancies some bikeshedding, I still don't have a name better than 'menu_login' for this module. To your paintbrushes!</p>
</div>
      

<div class="field field--name-field-tags field--type-entity-reference field--label-above field--tags">
      <h3 class="field__label field--tags__label">Tags</h3>
    <ul class="links field__items field--tags__items">
          <li class="field--tags__item"><a href="/taxonomy/term/1" hreflang="en">drupal</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/6" hreflang="en">drupal planet</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/38" hreflang="en">drupal 7</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/39" hreflang="en">menu system</a></li>
      </ul>
</div>

  </div>
  </article>
</div>
    <div class="views-row">

<article class="node node--type-article grid-full node--view-mode-full">
  <header class="layout--content-narrow">
    
            <h2 class="node__title">
        <a href="/blog/oxford-comma/503" rel="bookmark">
<span>The Oxford Comma</span>
</a>
      </h2>
        
          <div class="node__meta">
              <div class="node__author-image">
          <div>
  </div>

        </div>
              <span>
          By <span><span>joachim</span></span>, Wed, 06/30/2010 - 15:59
        </span>
        
      </div>
      </header>
  <div class="node__content layout--content-narrow">
        
            <div class="text-content clearfix field field--name-body field--type-text-with-summary field--label-hidden field__item"><p>Here's a little function I wrote today because I needed to be able to turn a list of between one and three items into a string like 'apples, oranges, and pears', 'apples and pears', or just '<a href="http://en.wikipedia.org/wiki/Rhyming_slang">stairs</a>'.</p>
<p>I figured I might as well handle everything in one place, and throw in the option to have an 'or' instead of an 'and'. There may be occasions you don't want the <a href="http://en.wikipedia.org/wiki/Oxford_comma">Oxford comma</a>, but I can't think of any.</p>
<div class="codeblock"><code>/**<br> * Grammatically fun helper to make a list of things in a sentence, ie<br> * turn an array into a string 'a, b, and c'.<br> *<br> * @param $list<br> *&nbsp; An array of words or items to join.<br> * @param $type<br> *&nbsp; The text to use between the last two items. Defaults to 'and'.<br> * @param $oxford<br> *&nbsp; Change this from default and you are a philistine.<br> */<br>function oxford_comma_list($list, $type = 'and', $oxford = TRUE) {<br>&nbsp; $final_join = " $type ";<br>&nbsp; if ($oxford &amp;&amp; count($list) &gt; 2) {<br>&nbsp;&nbsp;&nbsp; $final_join = ',' . $final_join;<br>&nbsp; }<br>&nbsp; $final = array_splice($list, -2, 2);&nbsp; <br>&nbsp; $final_string = implode($final_join, $final);<br>&nbsp; array_push($list, $final_string);<br>&nbsp; return implode(', ', $list);<br>}</code></div>
<p>Now the real question: how would you make this translatable?</p>
</div>
      

<div class="field field--name-field-tags field--type-entity-reference field--label-above field--tags">
      <h3 class="field__label field--tags__label">Tags</h3>
    <ul class="links field__items field--tags__items">
          <li class="field--tags__item"><a href="/taxonomy/term/1" hreflang="en">drupal</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/35" hreflang="en">php</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/36" hreflang="en">theming</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/6" hreflang="en">drupal planet</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/37" hreflang="en">text</a></li>
      </ul>
</div>

  </div>
  </article>
</div>
    <div class="views-row">

<article class="node node--type-article grid-full node--view-mode-full">
  <header class="layout--content-narrow">
    
            <h2 class="node__title">
        <a href="/blog/using-constants-permission-names-why/502" rel="bookmark">
<span>Using Constants For Permission Names: WHY?</span>
</a>
      </h2>
        
          <div class="node__meta">
              <div class="node__author-image">
          <div>
  </div>

        </div>
              <span>
          By <span><span>joachim</span></span>, Wed, 06/30/2010 - 14:19
        </span>
        
      </div>
      </header>
  <div class="node__content layout--content-narrow">
        
            <div class="text-content clearfix field field--name-body field--type-text-with-summary field--label-hidden field__item"><p>I keep seeing this sort of thing in so many modules:</p>
<div class="codeblock"><code>define("MY_MODULE_PERM_ACCESS_WIDGETS", 'access widgets');<br>// Names changed to protect the guilty ;)</code></div>
<p>Am I missing something, or is this utterly pointless?</p>
<p>The only advantage I see is that you can change the permission string later on. But you actually can't change a permission string once you've made a release without an almighty amount of work in a <a href="http://api.drupal.org/api/function/hook_update_N/6">hook_update_N()</a>[*] to migrate users' existing permissions, so what is the point of using a constant apart from just creating shouty caps noise?</p>
<p>[*] Is there a helper function in core yet for migrating permission names during updates? There really should be.</p>
</div>
      

<div class="field field--name-field-tags field--type-entity-reference field--label-above field--tags">
      <h3 class="field__label field--tags__label">Tags</h3>
    <ul class="links field__items field--tags__items">
          <li class="field--tags__item"><a href="/taxonomy/term/1" hreflang="en">drupal</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/11" hreflang="en">code style</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/6" hreflang="en">drupal planet</a></li>
          <li class="field--tags__item"><a href="/taxonomy/term/19" hreflang="en">wtf</a></li>
      </ul>
</div>

  </div>
  </article>
</div>

    </div>
  
        <nav class="pager layout--content-medium" role="navigation" aria-labelledby="pagination-heading">
    <h4 id="pagination-heading" class="visually-hidden">Pagination</h4>
    <ul class="pager__items js-pager__items">
                    <li class="pager__item pager__item--control pager__item--first"><a href="/" title="Go to first page" class="pager__link"><span class="visually-hidden">First page</span><svg xmlns="http://www.w3.org/2000/svg" width="15px" height="16px" viewBox="0 0 15 16"><path d="M5.1,7.2l8.3-6C14.1,0.7,15,1.1,15,2V14c0,0.8-0.9,1.3-1.6,0.8l-8.3-6C4.6,8.4,4.6,7.6,5.1,7.2z M0,0h2v16H0V0z"/></svg></a></li>      
                    <li class="pager__item pager__item--control pager__item--previous"><a href="/page/8" title="Go to previous page" rel="prev" class="pager__link"><span class="visually-hidden">Previous page</span><svg xmlns="http://www.w3.org/2000/svg" width="11" height="16" viewBox="0 0 11 16"><path d="M1.11201 7.19126L9.41183 1.15503C10.0728 0.674329 11 1.14648 11 1.96377V14.0362C11 14.8535 10.0728 15.3257 9.41183 14.845L1.11201 8.80874C0.562908 8.40939 0.562907 7.59061 1.11201 7.19126Z"/></svg></a></li>      
                    <li class="pager__item pager__item--ellipsis" role="presentation">&hellip;</li>
      
                    <li class="pager__item pager__item--number"><a href="/page/4" title="Go to page 4" class="pager__link"><span class="visually-hidden">
              Page
            </span>
            4
                          </a></li>              <li class="pager__item pager__item--number"><a href="/page/5" title="Go to page 5" class="pager__link"><span class="visually-hidden">
              Page
            </span>
            5
                          </a></li>              <li class="pager__item pager__item--number"><a href="/page/6" title="Go to page 6" class="pager__link"><span class="visually-hidden">
              Page
            </span>
            6
                          </a></li>              <li class="pager__item pager__item--number"><a href="/page/7" title="Go to page 7" class="pager__link"><span class="visually-hidden">
              Page
            </span>
            7
                          </a></li>              <li class="pager__item pager__item--number"><a href="/page/8" title="Go to page 8" class="pager__link"><span class="visually-hidden">
              Page
            </span>
            8
                          </a></li>              <li class="pager__item pager__item--active pager__item--number"><span class="visually-hidden">
              Current page
            </span>
            9
                      </li>              <li class="pager__item pager__item--number"><a href="/page/10" title="Go to page 10" class="pager__link"><span class="visually-hidden">
              Page
            </span>
            10
                          </a></li>              <li class="pager__item pager__item--number"><a href="/page/11" title="Go to page 11" class="pager__link"><span class="visually-hidden">
              Page
            </span>
            11
                          </a></li>              <li class="pager__item pager__item--number"><a href="/page/12" title="Go to page 12" class="pager__link"><span class="visually-hidden">
              Page
            </span>
            12
                          </a></li>      
            
                    <li class="pager__item pager__item--control pager__item--next"><a href="/page/10" title="Go to next page" rel="next" class="pager__link"><span class="visually-hidden">Next page</span><svg xmlns="http://www.w3.org/2000/svg" width="11" height="16" viewBox="0 0 11 16"><path d="M1.11201 7.19126L9.41183 1.15503C10.0728 0.674329 11 1.14648 11 1.96377V14.0362C11 14.8535 10.0728 15.3257 9.41183 14.845L1.11201 8.80874C0.562908 8.40939 0.562907 7.59061 1.11201 7.19126Z"/></svg></a></li>      
                    <li class="pager__item pager__item--control pager__item--last"><a href="/page/12" title="Go to last page" class="pager__link"><span class="visually-hidden">Last page</span><svg xmlns="http://www.w3.org/2000/svg" width="15px" height="16px" viewBox="0 0 15 16"><path d="M5.1,7.2l8.3-6C14.1,0.7,15,1.1,15,2V14c0,0.8-0.9,1.3-1.6,0.8l-8.3-6C4.6,8.4,4.6,7.6,5.1,7.2z M0,0h2v16H0V0z"/></svg></a></li>          </ul>
  </nav>

              <div class="feed-icons">
      


<a href="https://joachim-n.github.io/blog.xml" class="feed-icon">
  <span class="feed-icon__label">
    Blog
  </span>
  <span class="feed-icon__icon" aria-hidden="true">
    <svg xmlns="http://www.w3.org/2000/svg" width="14.2" height="14.2" viewBox="0 0 14.2 14.2">
  <path d="M4,12.2c0-2.5-3.9-2.4-3.9,0C0.1,14.7,4,14.6,4,12.2z M9.1,13.4C8.7,9,5.2,5.5,0.8,5.1c-1,0-1,2.7-0.1,2.7c3.1,0.3,5.5,2.7,5.8,5.8c0,0.7,2.1,0.7,2.5,0.3C9.1,13.7,9.1,13.6,9.1,13.4z M14.2,13.5c-0.1-3.5-1.6-6.9-4.1-9.3C7.6,1.7,4.3,0.2,0.8,0c-1,0-1,2.6-0.1,2.6c5.8,0.3,10.5,5,10.8,10.8C11.5,14.5,14.3,14.4,14.2,13.5z"/>
</svg>
  </span>
</a>

    </div>
  </div>
</div>

    </div>
  </div>

  </div>

              </main>
                        
          </div>
        </div>
        <div class="social-bar">
          
        </div>
      </div>
    </div>

    <footer class="site-footer">
      <div class="site-footer__inner container">
        

  <div class="region region--footer-top grid-full layout--pass--content-medium">
    <div class="region--footer_top__inner">
      

<div id="block-joachim-blog-theme-powered" class="block block-system block-system-powered-by-block">
  
    
    
  <span>
    Powered by    <a href="https://www.drupal.org">Drupal</a>
    <span class="drupal-logo" role="img" aria-label="Drupal Logo">
      <svg width="14" height="19" viewBox="0 0 42.15 55.08" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M29.75 11.73C25.87 7.86 22.18 4.16 21.08 0 20 4.16 16.28 7.86 12.4 11.73 6.59 17.54 0 24.12 0 34a21.08 21.08 0 1042.15 0c0-9.88-6.59-16.46-12.4-22.27zM10.84 35.92a14.13 14.13 0 00-1.65 2.62.54.54 0 01-.36.3h-.18c-.47 0-1-.92-1-.92-.14-.22-.27-.45-.4-.69l-.09-.19C5.94 34.25 7 30.28 7 30.28a17.42 17.42 0 012.52-5.41 31.53 31.53 0 012.28-3l1 1 4.72 4.82a.54.54 0 010 .72l-4.93 5.47zm10.48 13.81a7.29 7.29 0 01-5.4-12.14c1.54-1.83 3.42-3.63 5.46-6 2.42 2.58 4 4.35 5.55 6.29a3.08 3.08 0 01.32.48 7.15 7.15 0 011.3 4.12 7.23 7.23 0 01-7.23 7.25zM35 38.14a.84.84 0 01-.67.58h-.14a1.22 1.22 0 01-.68-.55 37.77 37.77 0 00-4.28-5.31l-1.93-2-6.41-6.65a54 54 0 01-3.84-3.94 1.3 1.3 0 00-.1-.15 3.84 3.84 0 01-.51-1v-.19a3.4 3.4 0 011-3c1.24-1.24 2.49-2.49 3.67-3.79 1.3 1.44 2.69 2.82 4.06 4.19a57.6 57.6 0 017.55 8.58A16 16 0 0135.65 34a14.55 14.55 0 01-.65 4.14z"/>
</svg>
    </span>
  </span>
</div>

    </div>
  </div>

        
      </div>
    </footer>

    <div class="overlay" data-drupal-selector="overlay"></div>

  </div>
</div>

  </div>

    
    <script type="application/json" data-drupal-selector="drupal-settings-json">{"path":{"baseUrl":"\/","pathPrefix":"","currentPath":"blog","currentPathIsAdmin":false,"isFront":true,"currentLanguage":"en","currentQuery":{"page":"8"}},"pluralDelimiter":"\u0003","suppressDeprecationErrors":true,"user":{"uid":0,"permissionsHash":"01dd47ecd9bcd15f4ce2dda67f9266a98e8b92ff7b9c64558fb5367373af7d61"}}</script>
<script src="/sites/default/files/js/js_8VAq5rHg72u4MA8hrGwHx9Lz8WNC8wFO7od1Rvg4xTA.js?scope=footer&amp;delta=0&amp;language=en&amp;theme=joachim_blog_theme&amp;include=eJxLzk9JTcvMKUkt0k-GM3Wy8hOTMzJz45Ny8tPjSzJSc1P103PykxJzdItLKnMy89IBYRsVxQ"></script>

  </body>
</html>
